<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Ираклий К. ДЗ 2</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
</head>

<body>
    <style>
        .list-group-item p {
            display: none;
        }
        .active p {
            display: block;
        }
    </style>
    <div class="container">
        <div class="list-group">
            <a href="#" class="list-group-item">
                <h4 class="list-group-item-heading name"></h4>
                <p class="list-group-item-text email"></p>
                <p class="list-group-item-text age"></p>
                <p class="list-group-item-text id"></p>
            </a>
        </div>
        <form action="#" class="message-form mt-5">
            <div class="form-group">
                <label for="name">Имя</label>
                <input type="text" class="name form-control" id="name" placeholder="Имя" required>
                <label for="email">Эл. Почта</label>
                <input type="email" class="e-mail form-control" id="email" placeholder="e-mail" required>
                <label for="age">Возраст</label>
                <input type="number" class="age form-control" id="age" placeholder="Возраст" required>
            </div>
            <button type="submit" class="btn btn-primary">Добавить</button>
        </form>
    </div>

    <script>
        function showAddUser() {
            let userData = []; //массив пользователей

            const userDataTemplate = document.querySelector('.list-group-item'); //шаблон карточки пользователя
            const userDataContainer = document.querySelector('.list-group'); //контейнер


            fetch('http://89.108.65.123/user/').then(function (result) {
                return result.json()
            }).then(function (text) {
                userData = text
                for (i = 0; i < userData.length; i++) {
                    const userDataTemplateClone = userDataTemplate.cloneNode(true); //клонируем карточку

                    userDataContainer.appendChild(userDataTemplateClone); //добавляем карточки на страницу

                    /*проверяем на отсутствие данных, к сожалению, некоторые пользователи записаны в виде массива,
                    как вытащить данные из него - не разобрался, из-за этого появились пустые строки */

                    if (userData[i].name == undefined || userData[i].email == undefined || userData[i].age ==
                        undefined) {
                        userDataTemplateClone.children[0].innerText = 'Нет данных'
                        userDataTemplateClone.children[1].innerText = 'Нет данных'
                        userDataTemplateClone.children[2].innerText = 'Нет данных'
                        userDataTemplateClone.children[3].innerText = `ID: ${i}`; //айди решил считать на пользовательской стороне
                    } else {
                        userDataTemplateClone.children[0].innerText = userData[i].name;
                        userDataTemplateClone.children[1].innerText = `E-Mail: ${userData[i].email}`;
                        userDataTemplateClone.children[2].innerText = `Возраст: ${userData[i].age}`;
                        userDataTemplateClone.children[3].innerText = `ID: ${i}`;
                    }
                    
                    /*цепляем на ссылки функцию, меняющую у них класс, для отображения/скрытия доп. инфы*/

                    userDataContainer.children[i].addEventListener('click', function (e) {
                        e.preventDefault();
                        if (this.classList.contains('active')) {
                            this.classList.remove('active');
                        } else {
                            this.classList.add('active');
                        }
                    })

                }
                userDataContainer.removeChild(userDataTemplate); //удаляем шаблон
                return text
            }).catch(function (error) {
                console.log(error)
            })
        }

        window.onload = showAddUser;
    </script>
</body>

</html>